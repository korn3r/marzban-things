# marzban-things

бэкап моих конфигов. надеюсь хотя бы одному человеку пригодится.
причем это просто бэкап без инструкций как развернуть, так что извините.
всё что можно настроено через сокеты.

## ru-node
Сервер в РФ. 
haproxy распределяет трафик на 443 порту по SNI на панели, крутящиеся на этом сервере. Далее трафик через vnext идет на нужную exit-node.

На сервере крутится сразу несколько панелей, так что конфиг haproxy на две панели (удалить из конфига лишнее должно быть не сложно, если надо)

!!! в конфиге нгинкса стоит перезапись путей панели, чтобы прятать ее за длинный путь. Сделано для 0.8.4, на релизе версии один работать не будет.


#### ru-node / sub_templates
набор темплейтов для раздачи через подписку. маршрутизация настроена по принципу "приватные адреса и адреса РФ идут прямо, остальное в прокси"
приватные адреса и адреса РФ настроено ресолвить через системный прокси, чтобы всякие локальные и корпоративные ресурсы нормально работали.

## exit-node
конфиги с сервера в Европе

## subscription.py
файл выдачи конфигурации через подписку для 0.8.4, в котором добавлена поддержка v2raytun (без нее не выдается роутинг, даже если настроен)
должен быть выставлен в True параметр USE_CUSTOM_JSON_DEFAULT в .env
если вдруг нужно чтобы выдавало всегда, можно заменить в subscription.py строку 
```
"elif USE_CUSTOM_JSON_DEFAULT and re.match(r'^v2raytun', user_agent):"
```
на 
```
"elif re.match(r'^v2raytun', user_agent):"
```
